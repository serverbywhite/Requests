# BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
    #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 

#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
import sys#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
#  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ #  BUG BY PHUOCAN, XÓA DÒNG NÀY LÀM CHÓ 
import threading
import traceback
import inspect
import functools

# Prevent double-install when sitecustomize runs multiple times in the same process
if getattr(sys, "_hook_debug_installed", False):
    # already installed
    sys.stderr.write("[sitecustomize] hook_debug already installed\n")
else:
    sys._hook_debug_installed = True

    LOG_FILE = "hetcuu.log"

    def safe_repr(obj):
        try:
            return str(obj)
        except Exception:
            try:
                return repr(obj)
            except Exception:
                return f"<{type(obj).__name__} object>"

    def log_output(msg: str):
        """Vừa in ra màn hình vừa ghi vào file"""
        try:
            # print to stderr to separate from program stdout if desired
            print(msg, file=sys.stderr)
            with open(LOG_FILE, "a", encoding="utf-8") as f:
                f.write(msg + "\n")
        except Exception:
            # swallow logging errors to avoid breaking target program
            pass

    def log_with_trace(prefix, detail=""):
        stack = "".join(traceback.format_stack(limit=6))
        log_output(f"{prefix} {detail}\n[STACKTRACE]\n{stack}")


    # Thread-local context to mark when execution is inside ChuyenHuongTiktok methods
    _local_ctx = threading.local()
    _local_ctx.in_chuyenhuong = False

    def in_chuyenhuong():
        return getattr(_local_ctx, "in_chuyenhuong", False)

    # ---------------- Install HTTP hooks ----------------
    try:
        import requests
    except Exception:
        requests = None

    try:
        import http.client as http_client
    except Exception:
        http_client = None

    # ---------------- URL filter ----------------
    def skip_url(url):
        try:
            url_lower = (url or "").lower()
            # ignore facebook.com / web.facebook.com per your original filter
            if "facebook.com" in url_lower and "web.facebook.com" not in url_lower:
                return True
            if "web.facebook.com" in url_lower:
                return True
            return False
        except Exception:
            return False

    # Hook requests.Session.request if requests available
    if requests is not None:
        try:
            _old_request = requests.Session.request

            def _hook_request(self, method, url, *a, **k):
                try:
                    if skip_url(url):
                        return _old_request(self, method, url, *a, **k)
                    tag = " [ở đây]" if in_chuyenhuong() else ""
                    log_with_trace(f"[HOOK][requests][REQ]{tag}", f"{safe_repr(method)} {safe_repr(url)} args={safe_repr(a)}, kwargs={safe_repr(k)}")
                    r = _old_request(self, method, url, *a, **k)
                    try:
                        status = getattr(r, "status_code", None)
                        headers = dict(getattr(r, "headers", {}) or {})
                        body = getattr(r, "text", None)
                    except Exception:
                        status = headers = body = None
                    log_output(f"[HOOK][requests][RESP]{tag} status={status} headers={headers} body={safe_repr(body)}")
                    return r
                except Exception as e:
                    # Fail-safe: if hook crashes, call original
                    log_output(f"[HOOK][requests][ERROR] {e}\n{traceback.format_exc()}")
                    return _old_request(self, method, url, *a, **k)

            requests.Session.request = _hook_request

            # Also wrap top-level convenience functions like requests.get/post/...
            for _m in ["get", "post", "put", "delete", "head", "options", "patch"]:
                if hasattr(requests, _m):
                    _old = getattr(requests, _m)

                    def _wrap(func, name):
                        def f(*a, **k):
                            try:
                                url = k.get("url") or (a[0] if a else "")
                                if skip_url(url):
                                    return func(*a, **k)
                                tag = " [ở đây]" if in_chuyenhuong() else ""
                                log_with_trace(f"[HOOK][requests.{name}][REQ]{tag}", f"args={safe_repr(a)}, kwargs={safe_repr(k)}")
                                r = func(*a, **k)
                                try:
                                    status = getattr(r, "status_code", None)
                                    headers = getattr(r, "headers", None)
                                    body = getattr(r, "text", None)
                                except Exception:
                                    status = headers = body = None
                                log_output(f"[HOOK][requests.{name}][RESP]{tag} status={status} headers={headers} body={safe_repr(body)}")
                                return r
                            except Exception as e:
                                log_output(f"[HOOK][requests.{name}][ERROR] {e}\n{traceback.format_exc()}")
                                return func(*a, **k)
                        return f
                    setattr(requests, _m, _wrap(_old, _m))

            log_output("[sitecustomize] requests hook installed")
        except Exception:
            log_output("[sitecustomize] failed to install requests hook\n" + traceback.format_exc())

    # Hook http.client if available
    if http_client is not None:
        try:
            _old_http_req = http_client.HTTPConnection.request

            def _hook_http_request(self, method, url, body=None, headers=None, *a, **k):
                try:
                    host = getattr(self, "host", "")
                    full_url = f"{host}{url}"
                    if skip_url(full_url):
                        return _old_http_req(self, method, url, body, headers, *a, **k)
                    tag = " [ở đây]" if in_chuyenhuong() else ""
                    log_with_trace(f"[HOOK][http.client]{tag}", f"{safe_repr(method)} host={safe_repr(host)} url={safe_repr(url)} body={safe_repr(body)} headers={safe_repr(headers)}")
                    return _old_http_req(self, method, url, body, headers, *a, **k)
                except Exception as e:
                    log_output(f"[HOOK][http.client][ERROR] {e}\n{traceback.format_exc()}")
                    return _old_http_req(self, method, url, body, headers, *a, **k)

            http_client.HTTPConnection.request = _hook_http_request
            log_output("[sitecustomize] http.client hook installed")
        except Exception:
            log_output("[sitecustomize] failed to install http.client hook\n" + traceback.format_exc())

    # Hook curl_cffi.requests if present
    try:
        from curl_cffi import requests as curl_requests  # type: ignore
    except Exception:
        curl_requests = None

    if curl_requests is not None:
        try:
            _old_curl_request = curl_requests.Session.request

            def _hook_curl_request(self, method, url, *a, **k):
                try:
                    if skip_url(url):
                        return _old_curl_request(self, method, url, *a, **k)
                    tag = " [ở đây]" if in_chuyenhuong() else ""
                    log_with_trace(f"[HOOK][curl_cffi][REQ]{tag}", f"{safe_repr(method)} {safe_repr(url)} args={safe_repr(a)}, kwargs={safe_repr(k)}")
                    r = _old_curl_request(self, method, url, *a, **k)
                    try:
                        status = getattr(r, "status_code", None)
                        headers = getattr(r, "headers", None)
                        body = getattr(r, "text", None)
                    except Exception:
                        status = headers = body = None
                    log_output(f"[HOOK][curl_cffi][RESP]{tag} status={status} headers={headers} body={safe_repr(body)}")
                    return r
                except Exception as e:
                    log_output(f"[HOOK][curl_cffi][ERROR] {e}\n{traceback.format_exc()}")
                    return _old_curl_request(self, method, url, *a, **k)

            curl_requests.Session.request = _hook_curl_request
            log_output("[sitecustomize] curl_cffi.requests hook installed")
        except Exception:
            log_output("[sitecustomize] failed to install curl_cffi hook\n" + traceback.format_exc())

    # ---------------- Hook class methods (ChuyenHuongTiktok) ----------------
    def hook_class_methods(cls):
        """Chỉ set context khi chạy method trong class này"""
        try:
            for name, method in inspect.getmembers(cls, inspect.isfunction):
                # avoid double-wrapping
                if getattr(method, "_is_chuyenhuong_wrapped", False):
                    continue

                @functools.wraps(method)
                def wrapper(*args, __method=method, __name=name, **kwargs):
                    _local_ctx.in_chuyenhuong = True
                    try:
                        return __method(*args, **kwargs)
                    finally:
                        _local_ctx.in_chuyenhuong = False

                # mark wrapper so we don't double-wrap if run again
                wrapper._is_chuyenhuong_wrapped = True
                setattr(cls, name, wrapper)
            return cls
        except Exception:
            log_output("[sitecustomize] hook_class_methods failed\n" + traceback.format_exc())
            return cls

    # Define ChuyenHuongTiktok here so external code can import it if desired.
    
    
    # Banner to indicate hook loaded
    try:
        log_output(">> BUG API BY PHUOCAN <<")
    except Exception:
        pass
